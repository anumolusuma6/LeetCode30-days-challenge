WITH TotalAmount AS (SELECT visited_on,
sum(amount) as total
FROM Customer
GROUP BY visited_on)

select visited_on, amount, average_amount from
(SELECT
    visited_on,
    SUM(total) OVER (ORDER BY visited_on ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS amount,
    ROUND(AVG(total) OVER (ORDER BY visited_on ROWS BETWEEN 6 PRECEDING AND CURRENT ROW), 2) AS average_amount
FROM totalamount) as temp
ORDER BY visited_on
LIMIT 999 OFFSET 6;


--or usage of date_sub

WITH TotalAmount AS (SELECT visited_on,
sum(amount) as total
FROM Customer
GROUP BY visited_on)

select visited_on, amount, average_amount from
(SELECT
    visited_on,
    SUM(total) OVER (ORDER BY visited_on ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS amount,
    ROUND(AVG(total) OVER (ORDER BY visited_on ROWS BETWEEN 6 PRECEDING AND CURRENT ROW), 2) AS average_amount
FROM totalamount) as temp
WHERE DATE_sub(visited_on, interval 6 DAY) in (select visited_on from totalamount)
ORDER BY visited_on
