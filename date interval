WITH TotalAmount AS (SELECT visited_on,
sum(amount) as total
FROM Customer
GROUP BY visited_on)

select visited_on, amount, average_amount from
(SELECT
    visited_on,
    SUM(total) OVER (ORDER BY visited_on ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS amount,
    ROUND(AVG(total) OVER (ORDER BY visited_on ROWS BETWEEN 6 PRECEDING AND CURRENT ROW), 2) AS average_amount
FROM totalamount) as temp
ORDER BY visited_on
LIMIT 999 OFFSET 6;


--or usage of date_sub

WITH TotalAmount AS (SELECT visited_on,
sum(amount) as total
FROM Customer
GROUP BY visited_on)

select visited_on, amount, average_amount from
(SELECT
    visited_on,
    SUM(total) OVER (ORDER BY visited_on ROWS BETWEEN 6 PRECEDING AND CURRENT ROW) AS amount,
    ROUND(AVG(total) OVER (ORDER BY visited_on ROWS BETWEEN 6 PRECEDING AND CURRENT ROW), 2) AS average_amount
FROM totalamount) as temp
WHERE DATE_sub(visited_on, interval 6 DAY) in (select visited_on from totalamount)
ORDER BY visited_on


--or

WITH CTE AS
(
SELECT
visited_on,
SUM(amount) as amount
FROM customer
GROUP BY visited_on
)

SELECT
visited_on,
ROUND(amount, 2) as amount,
ROUND(amount / 7, 2) as average_amount
----in the problem it is getting accepted only for 7 days 
FROM
(
SELECT
c.visited_on,
SUM(c.amount) OVER (
ORDER BY c.visited_on RANGE BETWEEN INTERVAL 6 DAY PRECEDING AND CURRENT ROW
) as amount
FROM CTE c
) as a
WHERE
a.visited_on >= (SELECT MIN(visited_on) FROM CTE) + INTERVAL 6 DAY
