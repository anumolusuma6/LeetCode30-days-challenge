SELECT a.month, a.country, COUNT(*) AS trans_count, 
       SUM(a.approved_count) AS approved_count, 
       SUM(a.amount) AS trans_total_amount, 
       SUM(CASE WHEN a.state = 'approved' THEN a.amount ELSE 0 END) AS approved_total_amount
FROM (
    SELECT country, LEFT(trans_date, 7) AS month, 
           CASE WHEN state = 'approved' THEN 1 ELSE 0 END AS approved_count,
           amount, state
    FROM Transactions
) AS a
GROUP BY a.country, a.month;
